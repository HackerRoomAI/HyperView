(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";let t;var n,r,i,s,l=e.i(43476),a=e.i(71645),o=e.i(74080);function c(e,t,n){let r,i=n.initialDeps??[];function s(){var s,l,a,o;let c,h;n.key&&(null==(s=n.debug)?void 0:s.call(n))&&(c=Date.now());let u=e();if(!(u.length!==i.length||u.some((e,t)=>i[t]!==e)))return r;if(i=u,n.key&&(null==(l=n.debug)?void 0:l.call(n))&&(h=Date.now()),r=t(...u),n.key&&(null==(a=n.debug)?void 0:a.call(n))){let e=Math.round((Date.now()-c)*100)/100,t=Math.round((Date.now()-h)*100)/100,r=t/16,i=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${i(t,5)} /${i(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*r,120))}deg 100% 31%);`,null==n?void 0:n.key)}return null==(o=null==n?void 0:n.onChange)||o.call(n,r),r}return s.updateDeps=e=>{i=e},s}function h(e,t){if(void 0!==e)return e;throw Error(`Unexpected undefined${t?`: ${t}`:""}`)}e.i(47167);let u=e=>{let{offsetWidth:t,offsetHeight:n}=e;return{width:t,height:n}},d=e=>e,f=e=>{let t=Math.max(e.startIndex-e.overscan,0),n=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let e=t;e<=n;e++)r.push(e);return r},m=(e,t)=>{let n=e.scrollElement;if(!n)return;let r=e.targetWindow;if(!r)return;let i=e=>{let{width:n,height:r}=e;t({width:Math.round(n),height:Math.round(r)})};if(i(u(n)),!r.ResizeObserver)return()=>{};let s=new r.ResizeObserver(t=>{let r=()=>{let e=t[0];if(null==e?void 0:e.borderBoxSize){let t=e.borderBoxSize[0];if(t)return void i({width:t.inlineSize,height:t.blockSize})}i(u(n))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return s.observe(n,{box:"border-box"}),()=>{s.unobserve(n)}},g={passive:!0},x="undefined"==typeof window||"onscrollend"in window,p=(e,t)=>{var n,r;let i,s=e.scrollElement;if(!s)return;let l=e.targetWindow;if(!l)return;let a=0,o=e.options.useScrollendEvent&&x?()=>void 0:(n=()=>{t(a,!1)},r=e.options.isScrollingResetDelay,function(...e){l.clearTimeout(i),i=l.setTimeout(()=>n.apply(this,e),r)}),c=n=>()=>{let{horizontal:r,isRtl:i}=e.options;a=r?s.scrollLeft*(i&&-1||1):s.scrollTop,o(),t(a,n)},h=c(!0),u=c(!1);u(),s.addEventListener("scroll",h,g);let d=e.options.useScrollendEvent&&x;return d&&s.addEventListener("scrollend",u,g),()=>{s.removeEventListener("scroll",h),d&&s.removeEventListener("scrollend",u)}},b=(e,t,n)=>{if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return Math.round(e[n.options.horizontal?"inlineSize":"blockSize"])}return e[n.options.horizontal?"offsetWidth":"offsetHeight"]},v=(e,{adjustments:t=0,behavior:n},r)=>{var i,s;null==(s=null==(i=r.scrollElement)?void 0:i.scrollTo)||s.call(i,{[r.options.horizontal?"left":"top"]:e+t,behavior:n})};class y{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null,t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{let t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var n;null==(n=t())||n.disconnect(),e=null},observe:e=>{var n;return null==(n=t())?void 0:n.observe(e,{box:"border-box"})},unobserve:e=>{var n;return null==(n=t())?void 0:n.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,n])=>{void 0===n&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:d,rangeExtractor:f,onChange:()=>{},measureElement:b,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,n;null==(n=(t=this.options).onChange)||n.call(t,this,e)},this.maybeNotify=c(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;let t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{let n=new Map,r=new Map;for(let i=t-1;i>=0;i--){let t=e[i];if(n.has(t.lane))continue;let s=r.get(t.lane);if(null==s||t.end>s.end?r.set(t.lane,t):t.end<s.end&&n.set(t.lane,!0),n.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=c(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,t,n,r,i)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:n,getItemKey:r,enabled:i}),{key:!1}),this.getMeasurements=c(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:n,getItemKey:r,enabled:i},s)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));let l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];let a=this.measurementsCache.slice(0,l);for(let i=l;i<e;i++){let e=r(i),l=1===this.options.lanes?a[i-1]:this.getFurthestMeasurement(a,i),o=l?l.end+this.options.gap:t+n,c=s.get(e),h="number"==typeof c?c:this.options.estimateSize(i),u=o+h,d=l?l.lane:i%this.options.lanes;a[i]={index:i,start:o,size:h,end:u,key:e,lane:d}}return this.measurementsCache=a,a},{key:!1,debug:()=>this.options.debug}),this.calculateRange=c(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,n,r)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:n,lanes:r}){let i=e.length-1;if(e.length<=r)return{startIndex:0,endIndex:i};let s=w(0,i,t=>e[t].start,n),l=s;if(1===r)for(;l<i&&e[l].end<n+t;)l++;else if(r>1){let a=Array(r).fill(0);for(;l<i&&a.some(e=>e<n+t);){let t=e[l];a[t.lane]=t.end,l++}let o=Array(r).fill(n+t);for(;s>=0&&o.some(e=>e>=n);){let t=e[s];o[t.lane]=t.start,s--}s=Math.max(0,s-s%r),l=Math.min(i,l+(r-1-l%r))}return{startIndex:s,endIndex:l}}({measurements:e,outerSize:t,scrollOffset:n,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=c(()=>{let e=null,t=null,n=this.calculateRange();return n&&(e=n.startIndex,t=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,n,r,i)=>null===r||null===i?[]:e({startIndex:r,endIndex:i,overscan:t,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{let t=this.options.indexAttribute,n=e.getAttribute(t);return n?parseInt(n,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{let n=this.indexFromElement(e),r=this.measurementsCache[n];if(!r)return;let i=r.key,s=this.elementsCache.get(i);s!==e&&(s&&this.observer.unobserve(s),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected&&this.resizeItem(n,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{let n=this.measurementsCache[e];if(!n)return;let r=t-(this.itemSizeCache.get(n.key)??n.size);0!==r&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(n,r,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=r,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=c(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{let n=[];for(let r=0,i=e.length;r<i;r++){let i=t[e[r]];n.push(i)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{let t=this.getMeasurements();if(0!==t.length)return h(t[w(0,t.length-1,e=>h(t[e]).start,e)])},this.getOffsetForAlignment=(e,t,n=0)=>{let r=this.getSize(),i=this.getScrollOffset();return"auto"===t&&(t=e>=i+r?"end":"start"),"center"===t?e+=(n-r)/2:"end"===t&&(e-=r),Math.max(Math.min(this.getTotalSize()+this.options.scrollMargin-r,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));let n=this.measurementsCache[e];if(!n)return;let r=this.getSize(),i=this.getScrollOffset();if("auto"===t)if(n.end>=i+r-this.options.scrollPaddingEnd)t="end";else{if(!(n.start<=i+this.options.scrollPaddingStart))return[i,t];t="start"}let s="end"===t?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(s,t,n.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:n})},this.scrollToIndex=(e,{align:t="auto",behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let r=0,i=t=>{if(!this.targetWindow)return;let r=this.getOffsetForIndex(e,t);if(!r)return void console.warn("Failed to get offset for index:",e);let[i,l]=r;this._scrollToOffset(i,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{let t=this.getScrollOffset(),n=this.getOffsetForIndex(e,l);n?1.01>Math.abs(n[0]-t)||s(l):console.warn("Failed to get offset for index:",e)})},s=t=>{this.targetWindow&&(++r<10?this.targetWindow.requestAnimationFrame(()=>i(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};i(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;let t,n=this.getMeasurements();if(0===n.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=n[n.length-1])?void 0:e.end)??0;else{let e=Array(this.options.lanes).fill(null),r=n.length-1;for(;r>=0&&e.some(e=>null===e);){let t=n[r];null===e[t.lane]&&(e[t.lane]=t.end),r--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}let w=(e,t,n,r)=>{for(;e<=t;){let i=(e+t)/2|0,s=n(i);if(s<r)e=i+1;else{if(!(s>r))return i;t=i-1}}return e>0?e-1:0},M="undefined"!=typeof document?a.useLayoutEffect:a.useEffect,N=e=>{let t,n=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:r,getState:i,getInitialState:()=>l,subscribe:e=>(n.add(e),()=>n.delete(e))},l=t=e(r,i,s);return s},j=e=>{let t=e?N(e):N,n=e=>(function(e,t=e=>e){let n=a.default.useSyncExternalStore(e.subscribe,a.default.useCallback(()=>t(e.getState()),[e,t]),a.default.useCallback(()=>t(e.getInitialState()),[e,t]));return a.default.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},S=(t=(e,t)=>({datasetInfo:null,setDatasetInfo:t=>e({datasetInfo:t}),samples:[],totalSamples:0,setSamples:(t,n)=>e({samples:t,totalSamples:n}),appendSamples:t=>e(e=>({samples:[...e.samples,...t]})),addSamplesIfMissing:t=>e(e=>{let n=new Set(e.samples.map(e=>e.id)),r=t.filter(e=>!n.has(e.id));return 0===r.length?e:{samples:[...e.samples,...r]}}),embeddings:null,setEmbeddings:t=>e({embeddings:t}),viewMode:"hyperbolic",setViewMode:t=>e({viewMode:t}),selectedIds:new Set,setSelectedIds:t=>e({selectedIds:t}),toggleSelection:t=>e(e=>{let n=new Set(e.selectedIds);return n.has(t)?n.delete(t):n.add(t),{selectedIds:n}}),addToSelection:t=>e(e=>{let n=new Set(e.selectedIds);return t.forEach(e=>n.add(e)),{selectedIds:n}}),clearSelection:()=>e({selectedIds:new Set}),hoveredId:null,setHoveredId:t=>e({hoveredId:t}),isLoading:!1,setIsLoading:t=>e({isLoading:t}),error:null,setError:t=>e({error:t}),filterLabel:null,setFilterLabel:t=>e({filterLabel:t}),showLabels:!0,setShowLabels:t=>e({showLabels:t})}))?j(t):j;function k({samples:e,onLoadMore:t,hasMore:n}){let r=(0,a.useRef)(null),{selectedIds:i,toggleSelection:s,addToSelection:c,setHoveredId:h,hoveredId:u}=S(),d=(0,a.useMemo)(()=>{if(0===i.size)return e;let t=[],n=[];return e.forEach(e=>{i.has(e.id)?t.push(e):n.push(e)}),[...t,...n]},[e,i]),f=function(e){let t=a.useReducer(()=>({}),{})[1],n={...e,onChange:(n,r)=>{var i;r?(0,o.flushSync)(t):t(),null==(i=e.onChange)||i.call(e,n,r)}},[r]=a.useState(()=>new y(n));return r.setOptions(n),M(()=>r._didMount(),[]),M(()=>r._willUpdate()),r}({observeElementRect:m,observeElementOffset:p,scrollToFn:v,...{count:Math.ceil(d.length/4),getScrollElement:()=>r.current,estimateSize:()=>148,overscan:5,getItemKey:(0,a.useCallback)(e=>{let t=4*e;return d.slice(t,t+4).map(e=>e.id).join("-")||`row-${e}`},[d])}});(0,a.useEffect)(()=>{let e=r.current;if(!e||!t||!n)return;let i=()=>{let{scrollTop:n,scrollHeight:r,clientHeight:i}=e;r-n-i<500&&t()};return e.addEventListener("scroll",i),()=>e.removeEventListener("scroll",i)},[t,n]);let g=(0,a.useRef)(new Set);(0,a.useEffect)(()=>{let e=g.current;(e.size!==i.size||[...i].some(t=>!e.has(t)))&&i.size>0&&(f.measure(),f.scrollToOffset(0,{behavior:"smooth"})),g.current=new Set(i)},[i,f]);let x=(0,a.useCallback)((e,t)=>{if(t.metaKey||t.ctrlKey)s(e.id);else if(t.shiftKey&&i.size>0){let t=Array.from(i),n=t[t.length-1],r=d.findIndex(e=>e.id===n),s=d.findIndex(t=>t.id===e.id);if(-1!==r&&-1!==s){let e=Math.min(r,s),t=Math.max(r,s);c(d.slice(e,t+1).map(e=>e.id))}}else{let t=new Set;t.add(e.id),S.getState().setSelectedIds(t)}},[d,i,s,c]),b=f.getVirtualItems();return(0,l.jsxs)("div",{className:"flex flex-col h-full bg-surface rounded-lg overflow-hidden",children:[(0,l.jsx)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border bg-surface-light",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:"Samples"}),(0,l.jsxs)("span",{className:"text-xs text-text-muted",children:[d.length," items",i.size>0&&` (${i.size} selected)`]})]})}),(0,l.jsx)("div",{ref:r,className:"flex-1 overflow-auto p-2",children:(0,l.jsx)("div",{style:{height:`${f.getTotalSize()}px`,width:"100%",position:"relative"},children:b.map(e=>{let t=4*e.index,n=d.slice(t,t+4);return(0,l.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"140px",transform:`translateY(${e.start}px)`},className:"flex gap-2 px-1",children:[n.map(e=>{let t=i.has(e.id),n=u===e.id;return(0,l.jsxs)("div",{className:`
                        relative flex-1 rounded-md overflow-hidden cursor-pointer
                        transition-all duration-150 ease-out
                        ${t?"ring-2 ring-primary":""}
                        ${n?"ring-2 ring-primary-light":""}
                      `,onClick:t=>x(e,t),onMouseEnter:()=>h(e.id),onMouseLeave:()=>h(null),children:[e.thumbnail?(0,l.jsx)("img",{src:`data:image/jpeg;base64,${e.thumbnail}`,alt:e.filename,className:"w-full h-full object-cover",loading:"lazy"}):(0,l.jsx)("div",{className:"w-full h-full bg-surface-light flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-text-muted text-xs",children:"No image"})}),e.label&&(0,l.jsx)("div",{className:"absolute bottom-1 left-1 right-1",children:(0,l.jsx)("span",{className:"inline-block px-1.5 py-0.5 text-xs rounded truncate max-w-full",style:{backgroundColor:"rgba(0,0,0,0.7)",color:"#fff"},children:e.label})}),t&&(0,l.jsx)("div",{className:"absolute top-1 right-1 w-5 h-5 rounded-full bg-primary flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},e.id)}),Array.from({length:4-n.length}).map((e,t)=>(0,l.jsx)("div",{className:"flex-1"},`empty-${t}`))]},e.key)})})})]})}let E=Math.sqrt(50),z=Math.sqrt(10),$=Math.sqrt(2);function C(e,t,n){let r,i,s,l=(t-e)/Math.max(0,n),a=Math.floor(Math.log10(l)),o=l/Math.pow(10,a),c=o>=E?10:o>=z?5:o>=$?2:1;return(a<0?(r=Math.round(e*(s=Math.pow(10,-a)/c)),i=Math.round(t*s),r/s<e&&++r,i/s>t&&--i,s=-s):(r=Math.round(e/(s=Math.pow(10,a)*c)),i=Math.round(t/s),r*s<e&&++r,i*s>t&&--i),i<r&&.5<=n&&n<2)?C(e,t,2*n):[r,i,s]}function O(e,t,n){return C(e*=1,t*=1,n*=1)[2]}function I(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function A(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function R(e){let t,n,r;function i(e,r,s=0,l=e.length){if(s<l){if(0!==t(r,r))return l;do{let t=s+l>>>1;0>n(e[t],r)?s=t+1:l=t}while(s<l)}return s}return 2!==e.length?(t=I,n=(t,n)=>I(e(t),n),r=(t,n)=>e(t)-n):(t=e===I||e===A?e:F,n=e,r=e),{left:i,center:function(e,t,n=0,s=e.length){let l=i(e,t,n,s-1);return l>n&&r(e[l-1],t)>-r(e[l],t)?l-1:l},right:function(e,r,i=0,s=e.length){if(i<s){if(0!==t(r,r))return s;do{let t=i+s>>>1;0>=n(e[t],r)?i=t+1:s=t}while(i<s)}return i}}}function F(){return 0}let T=R(I),L=T.right;function W(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function D(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function P(){}T.left,R(function(e){return null===e?NaN:+e}).center;var _="\\s*([+-]?\\d+)\\s*",q="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",H="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",V=/^#([0-9a-f]{3,8})$/,B=RegExp(`^rgb\\(${_},${_},${_}\\)$`),K=RegExp(`^rgb\\(${H},${H},${H}\\)$`),U=RegExp(`^rgba\\(${_},${_},${_},${q}\\)$`),X=RegExp(`^rgba\\(${H},${H},${H},${q}\\)$`),Y=RegExp(`^hsl\\(${q},${H},${H}\\)$`),G=RegExp(`^hsla\\(${q},${H},${H},${q}\\)$`),J={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function Z(){return this.rgb().formatHex()}function Q(){return this.rgb().formatRgb()}function ee(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=V.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?et(t):3===n?new ei(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?en(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?en(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=B.exec(e))?new ei(t[1],t[2],t[3],1):(t=K.exec(e))?new ei(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=U.exec(e))?en(t[1],t[2],t[3],t[4]):(t=X.exec(e))?en(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Y.exec(e))?eh(t[1],t[2]/100,t[3]/100,1):(t=G.exec(e))?eh(t[1],t[2]/100,t[3]/100,t[4]):J.hasOwnProperty(e)?et(J[e]):"transparent"===e?new ei(NaN,NaN,NaN,0):null}function et(e){return new ei(e>>16&255,e>>8&255,255&e,1)}function en(e,t,n,r){return r<=0&&(e=t=n=NaN),new ei(e,t,n,r)}function er(e,t,n,r){var i;return 1==arguments.length?((i=e)instanceof P||(i=ee(i)),i)?new ei((i=i.rgb()).r,i.g,i.b,i.opacity):new ei:new ei(e,t,n,null==r?1:r)}function ei(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function es(){return`#${ec(this.r)}${ec(this.g)}${ec(this.b)}`}function el(){let e=ea(this.opacity);return`${1===e?"rgb(":"rgba("}${eo(this.r)}, ${eo(this.g)}, ${eo(this.b)}${1===e?")":`, ${e})`}`}function ea(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function eo(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ec(e){return((e=eo(e))<16?"0":"")+e.toString(16)}function eh(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ed(e,t,n,r)}function eu(e){if(e instanceof ed)return new ed(e.h,e.s,e.l,e.opacity);if(e instanceof P||(e=ee(e)),!e)return new ed;if(e instanceof ed)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),l=NaN,a=s-i,o=(s+i)/2;return a?(l=t===s?(n-r)/a+(n<r)*6:n===s?(r-t)/a+2:(t-n)/a+4,a/=o<.5?s+i:2-s-i,l*=60):a=o>0&&o<1?0:l,new ed(l,a,o,e.opacity)}function ed(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function ef(e){return(e=(e||0)%360)<0?e+360:e}function em(e){return Math.max(0,Math.min(1,e||0))}function eg(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}function ex(e,t,n,r,i){var s=e*e,l=s*e;return((1-3*e+3*s-l)*t+(4-6*s+3*l)*n+(1+3*e+3*s-3*l)*r+l*i)/6}W(P,ee,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Z,formatHex:Z,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return eu(this).formatHsl()},formatRgb:Q,toString:Q}),W(ei,er,D(P,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new ei(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new ei(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ei(eo(this.r),eo(this.g),eo(this.b),ea(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:es,formatHex:es,formatHex8:function(){return`#${ec(this.r)}${ec(this.g)}${ec(this.b)}${ec((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:el,toString:el})),W(ed,function(e,t,n,r){return 1==arguments.length?eu(e):new ed(e,t,n,null==r?1:r)},D(P,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new ed(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new ed(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new ei(eg(e>=240?e-240:e+120,i,r),eg(e,i,r),eg(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new ed(ef(this.h),em(this.s),em(this.l),ea(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=ea(this.opacity);return`${1===e?"hsl(":"hsla("}${ef(this.h)}, ${100*em(this.s)}%, ${100*em(this.l)}%${1===e?")":`, ${e})`}`}}));let ep=e=>()=>e;function eb(e,t){var n=t-e;return n?function(t){return e+t*n}:ep(isNaN(e)?t:e)}let ev=function e(t){var n,r=1==(n=+t)?eb:function(e,t){var r,i,s;return t-e?(r=e,i=t,r=Math.pow(r,s=n),i=Math.pow(i,s)-r,s=1/s,function(e){return Math.pow(r+e*i,s)}):ep(isNaN(e)?t:e)};function i(e,t){var n=r((e=er(e)).r,(t=er(t)).r),i=r(e.g,t.g),s=r(e.b,t.b),l=eb(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=s(t),e.opacity=l(t),e+""}}return i.gamma=e,i}(1);function ey(e){return function(t){var n,r,i=t.length,s=Array(i),l=Array(i),a=Array(i);for(n=0;n<i;++n)r=er(t[n]),s[n]=r.r||0,l[n]=r.g||0,a[n]=r.b||0;return s=e(s),l=e(l),a=e(a),r.opacity=1,function(e){return r.r=s(e),r.g=l(e),r.b=a(e),r+""}}}function ew(e,t){return e*=1,t*=1,function(n){return e*(1-n)+t*n}}ey(function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],l=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return ex((n-r/t)*t,l,i,s,a)}}),ey(function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],l=e[(r+1)%t],a=e[(r+2)%t];return ex((n-r/t)*t,i,s,l,a)}});var eM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,eN=RegExp(eM.source,"g");function ej(e,t){return e*=1,t*=1,function(n){return Math.round(e*(1-n)+t*n)}}function eS(e){return+e}var ek=[0,1];function eE(e){return e}function ez(e,t){var n;return(t-=e*=1)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n})}function e$(e,t,n){var r=e[0],i=e[1],s=t[0],l=t[1];return i<r?(r=ez(i,r),s=n(l,s)):(r=ez(r,i),s=n(s,l)),function(e){return s(r(e))}}function eC(e,t,n){var r=Math.min(e.length,t.length)-1,i=Array(r),s=Array(r),l=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++l<r;)i[l]=ez(e[l],e[l+1]),s[l]=n(t[l],t[l+1]);return function(t){var n=L(e,t,1,r)-1;return s[n](i[n](t))}}function eO(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function eI(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function eA(e){return(e=eI(Math.abs(e)))?e[1]:NaN}var eR=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function eF(e){var t;if(!(t=eR.exec(e)))throw Error("invalid format: "+e);return new eT({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function eT(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function eL(e,t){var n=eI(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+Array(i-r.length+2).join("0")}eF.prototype=eT.prototype,eT.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};let eW={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>eL(100*e,t),r:eL,s:function(e,t){var r=eI(e,t);if(!r)return e+"";var i=r[0],s=r[1],l=s-(n=3*Math.max(-8,Math.min(8,Math.floor(s/3))))+1,a=i.length;return l===a?i:l>a?i+Array(l-a+1).join("0"):l>0?i.slice(0,l)+"."+i.slice(l):"0."+Array(1-l).join("0")+eI(e,Math.max(0,t+l-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function eD(e){return e}var eP=Array.prototype.map,e_=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function eq(){var e,t=(function(){var e,t,n,r,i,s,l=ek,a=ek,o=function e(t,n){var r,i,s=typeof n;return null==n||"boolean"===s?ep(n):("number"===s?ew:"string"===s?(i=ee(n))?(n=i,ev):function(e,t){var n,r,i,s,l,a=eM.lastIndex=eN.lastIndex=0,o=-1,c=[],h=[];for(e+="",t+="";(i=eM.exec(e))&&(s=eN.exec(t));)(l=s.index)>a&&(l=t.slice(a,l),c[o]?c[o]+=l:c[++o]=l),(i=i[0])===(s=s[0])?c[o]?c[o]+=s:c[++o]=s:(c[++o]=null,h.push({i:o,x:ew(i,s)})),a=eN.lastIndex;return a<t.length&&(l=t.slice(a),c[o]?c[o]+=l:c[++o]=l),c.length<2?h[0]?(n=h[0].x,function(e){return n(e)+""}):(r=t,function(){return r}):(t=h.length,function(e){for(var n,r=0;r<t;++r)c[(n=h[r]).i]=n.x(e);return c.join("")})}:n instanceof ee?ev:n instanceof Date?function(e,t){var n=new Date;return e*=1,t*=1,function(r){return n.setTime(e*(1-r)+t*r),n}}:!ArrayBuffer.isView(r=n)||r instanceof DataView?Array.isArray(n)?function(t,n){var r,i=n?n.length:0,s=t?Math.min(i,t.length):0,l=Array(s),a=Array(i);for(r=0;r<s;++r)l[r]=e(t[r],n[r]);for(;r<i;++r)a[r]=n[r];return function(e){for(r=0;r<s;++r)a[r]=l[r](e);return a}}:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?function(t,n){var r,i={},s={};for(r in(null===t||"object"!=typeof t)&&(t={}),(null===n||"object"!=typeof n)&&(n={}),n)r in t?i[r]=e(t[r],n[r]):s[r]=n[r];return function(e){for(r in i)s[r]=i[r](e);return s}}:ew:function(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(s){for(n=0;n<r;++n)i[n]=e[n]*(1-s)+t[n]*s;return i}})(t,n)},c=eE;function h(){var e,t,n,o=Math.min(l.length,a.length);return c!==eE&&(e=l[0],t=l[o-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=o>2?eC:e$,i=s=null,u}function u(t){return null==t||isNaN(t*=1)?n:(i||(i=r(l.map(e),a,o)))(e(c(t)))}return u.invert=function(n){return c(t((s||(s=r(a,l.map(e),ew)))(n)))},u.domain=function(e){return arguments.length?(l=Array.from(e,eS),h()):l.slice()},u.range=function(e){return arguments.length?(a=Array.from(e),h()):a.slice()},u.rangeRound=function(e){return a=Array.from(e),o=ej,h()},u.clamp=function(e){return arguments.length?(c=!!e||eE,h()):c!==eE},u.interpolate=function(e){return arguments.length?(o=e,h()):o},u.unknown=function(e){return arguments.length?(n=e,u):n},function(n,r){return e=n,t=r,h()}})()(eE,eE);return t.copy=function(){return eq().domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())},eO.apply(t,arguments),e=t.domain,t.ticks=function(t){var n=e();return function(e,t,n){if(t*=1,e*=1,!((n*=1)>0))return[];if(e===t)return[e];let r=t<e,[i,s,l]=r?C(t,e,n):C(e,t,n);if(!(s>=i))return[];let a=s-i+1,o=Array(a);if(r)if(l<0)for(let e=0;e<a;++e)o[e]=-((s-e)/l);else for(let e=0;e<a;++e)o[e]=(s-e)*l;else if(l<0)for(let e=0;e<a;++e)o[e]=-((i+e)/l);else for(let e=0;e<a;++e)o[e]=(i+e)*l;return o}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return function(e,t,n,r){let l,a;var o,c,h,u,d,f=(c=e,h=+t,c*=1,u=+n,a=(l=h<c)?O(h,c,u):O(c,h,u),(l?-1:1)*(a<0?-(1/a):a));switch((r=eF(null==r?",f":r)).type){case"s":var m=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(d=Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(eA(m)/3)))-eA(Math.abs(f))))||(r.precision=d),s(r,m);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(d=Math.max(0,eA(Math.abs(Math.max(Math.abs(e),Math.abs(t)))-(o=Math.abs(o=f)))-eA(o))+1)||(r.precision=d-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(d=Math.max(0,-eA(Math.abs(f))))||(r.precision=d-("%"===r.type)*2)}return i(r)}(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,s=e(),l=0,a=s.length-1,o=s[l],c=s[a],h=10;for(c<o&&(i=o,o=c,c=i,i=l,l=a,a=i);h-- >0;){if((i=O(o,c,n))===r)return s[l]=o,s[a]=c,e(s);if(i>0)o=Math.floor(o/i)*i,c=Math.ceil(c/i)*i;else if(i<0)o=Math.ceil(o*i)/i,c=Math.floor(c*i)/i;else break;r=i}return t},t}i=(r=function(e){var t,r,i,s=void 0===e.grouping||void 0===e.thousands?eD:(t=eP.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,s=[],l=0,a=t[0],o=0;i>0&&a>0&&(o+a+1>n&&(a=Math.max(1,n-o)),s.push(e.substring(i-=a,i+a)),!((o+=a+1)>n));)a=t[l=(l+1)%t.length];return s.reverse().join(r)}),l=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",c=void 0===e.numerals?eD:(i=eP.call(e.numerals,String),function(e){return e.replace(/[0-9]/g,function(e){return i[+e]})}),h=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"−":e.minus+"",d=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=eF(e)).fill,r=e.align,i=e.sign,f=e.symbol,m=e.zero,g=e.width,x=e.comma,p=e.precision,b=e.trim,v=e.type;"n"===v?(x=!0,v="g"):eW[v]||(void 0===p&&(p=12),b=!0,v="g"),(m||"0"===t&&"="===r)&&(m=!0,t="0",r="=");var y="$"===f?l:"#"===f&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",w="$"===f?a:/[%p]/.test(v)?h:"",M=eW[v],N=/[defgprs%]/.test(v);function j(e){var l,a,h,f=y,j=w;if("c"===v)j=M(e)+j,e="";else{var S=(e*=1)<0||1/e<0;if(e=isNaN(e)?d:M(Math.abs(e),p),b&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==i&&(S=!1),f=(S?"("===i?i:u:"-"===i||"("===i?"":i)+f,j=("s"===v?e_[8+n/3]:"")+j+(S&&"("===i?")":""),N){for(l=-1,a=e.length;++l<a;)if(48>(h=e.charCodeAt(l))||h>57){j=(46===h?o+e.slice(l+1):e.slice(l))+j,e=e.slice(0,l);break}}}x&&!m&&(e=s(e,1/0));var k=f.length+e.length+j.length,E=k<g?Array(g-k+1).join(t):"";switch(x&&m&&(e=s(E+e,E.length?g-j.length:1/0),E=""),r){case"<":e=f+e+j+E;break;case"=":e=f+E+e+j;break;case"^":e=E.slice(0,k=E.length>>1)+f+e+j+E.slice(k);break;default:e=E+f+e+j}return c(e)}return p=void 0===p?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,p)):Math.max(0,Math.min(20,p)),j.toString=function(){return e+""},j}return{format:f,formatPrefix:function(e,t){var n=f(((e=eF(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(eA(t)/3))),i=Math.pow(10,-r),s=e_[8+r/3];return function(e){return n(i*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]})).format,s=r.formatPrefix;let eH=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000"];function eV({className:t=""}){let n=(0,a.useRef)(null),r=(0,a.useRef)(null),i=(0,a.useRef)(null),s=(0,a.useRef)(null),[o,c]=(0,a.useState)(!1),{embeddings:h,viewMode:u,setViewMode:d,selectedIds:f,setSelectedIds:m,hoveredId:g,setHoveredId:x}=S(),p=(0,a.useCallback)(e=>{let{xScale:t,yScale:n}=e;if(i.current&&t&&n){let e=t(1)-t(0),r=n(1)-n(0),s=t(0),l=n(0);i.current.setAttribute("transform",`matrix(${e}, 0, 0, ${r}, ${s}, ${l})`)}},[]);(0,a.useEffect)(()=>{if(n.current&&r.current&&!o)return(async()=>{try{let t=(await e.A(93347)).default;if(!n.current||!r.current)return;let{width:i,height:l}=r.current.getBoundingClientRect(),a=eq().domain([-1,1]),o=eq().domain([-1,1]),h=t({canvas:n.current,width:i,height:l,xScale:a,yScale:o,pointSize:4,pointSizeSelected:8,opacity:.8,opacityInactiveMax:.2,lassoColor:[.31,.27,.9,1],lassoMinDelay:10,lassoMinDist:2,showReticle:!0,reticleColor:[1,1,1,.5],colorBy:"category",pointColor:eH});h.subscribe("view",p);let u=h.get("xScale"),d=h.get("yScale");u&&d&&p({xScale:u,yScale:d}),h.subscribe("select",({points:e})=>{if(e.length>0){let t=S.getState().embeddings;if(t){let n=new Set(e.map(e=>t.ids[e]));m(n)}}}),h.subscribe("deselect",()=>{m(new Set)}),h.subscribe("pointOver",e=>{let t=S.getState().embeddings;t&&e>=0&&x(t.ids[e])}),h.subscribe("pointOut",()=>{x(null)}),s.current=h,c(!0)}catch(e){console.error("Failed to initialize scatterplot:",e)}})(),()=>{s.current&&(s.current.destroy(),s.current=null,c(!1))}},[p]),(0,a.useEffect)(()=>{if(!s.current||!h)return;let e="euclidean"===u?h.euclidean:h.hyperbolic;"hyperbolic"===u&&setTimeout(()=>{if(s.current){let e=s.current.get("xScale"),t=s.current.get("yScale");e&&t&&p({xScale:e,yScale:t})}},0);let t=[...new Set(h.labels.map(e=>e||"undefined"))],n={};t.forEach((e,t)=>{n[e]=t});let r=h.labels.map(e=>n[e||"undefined"]),i=t.map(e=>"undefined"===e?"#008080":h.label_colors[e]||"#808080");i.length>0&&s.current.set({pointColor:i}),s.current.draw({x:e.map(e=>e[0]),y:e.map(e=>e[1]),category:r}),s.current.reset(),"hyperbolic"===u&&setTimeout(()=>{let e=s.current.get("view");e&&p(e)},100)},[h,u,o,p]),(0,a.useEffect)(()=>{if(!s.current||!h)return;let e=Array.from(f).map(e=>h.ids.indexOf(e)).filter(e=>-1!==e);s.current.select(e,{preventEvent:!0})},[f,h,o]),(0,a.useEffect)(()=>{if(!r.current||!s.current)return;let e=new ResizeObserver(e=>{for(let t of e){let{width:e,height:n}=t.contentRect;e>0&&n>0&&s.current&&s.current.set({width:e,height:n})}});return e.observe(r.current),()=>e.disconnect()},[o]);let b=h?[...new Set(h.labels.map(e=>e||"undefined"))]:[];return(0,l.jsxs)("div",{className:`flex flex-col h-full bg-surface rounded-lg overflow-hidden ${t}`,children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border bg-surface-light",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:"Embeddings"}),(0,l.jsxs)("div",{className:"flex rounded-md overflow-hidden border border-border",children:[(0,l.jsx)("button",{onClick:()=>d("euclidean"),className:`px-3 py-1 text-xs transition-colors ${"euclidean"===u?"bg-primary text-white":"bg-surface hover:bg-surface-light text-text-muted"}`,children:"Euclidean"}),(0,l.jsx)("button",{onClick:()=>d("hyperbolic"),className:`px-3 py-1 text-xs transition-colors ${"hyperbolic"===u?"bg-primary text-white":"bg-surface hover:bg-surface-light text-text-muted"}`,children:"Hyperbolic"})]})]}),(0,l.jsx)("span",{className:"text-xs text-text-muted",children:h?`${h.ids.length} points`:"Loading..."})]}),(0,l.jsxs)("div",{className:"flex-1 flex",children:[(0,l.jsxs)("div",{ref:r,className:"flex-1 relative",children:[(0,l.jsx)("canvas",{ref:n,className:"absolute inset-0",style:{zIndex:1}}),"hyperbolic"===u&&(0,l.jsx)("svg",{className:"absolute inset-0 pointer-events-none",width:"100%",height:"100%",style:{zIndex:10},children:(0,l.jsxs)("g",{ref:i,children:[(0,l.jsx)("circle",{cx:"0",cy:"0",r:"1",fill:"none",stroke:"rgba(255,255,255,0.6)",strokeWidth:"0.01"}),(0,l.jsx)("circle",{cx:"0",cy:"0",r:"0.462",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"}),(0,l.jsx)("circle",{cx:"0",cy:"0",r:"0.761",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"}),(0,l.jsx)("circle",{cx:"0",cy:"0",r:"0.905",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"}),(0,l.jsx)("line",{x1:"-1",y1:"0",x2:"1",y2:"0",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"}),(0,l.jsx)("line",{x1:"0",y1:"-1",x2:"0",y2:"1",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"}),(0,l.jsx)("line",{x1:"-0.707",y1:"-0.707",x2:"0.707",y2:"0.707",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"}),(0,l.jsx)("line",{x1:"-0.707",y1:"0.707",x2:"0.707",y2:"-0.707",stroke:"rgba(255,255,255,0.2)",strokeWidth:"0.005"})]})}),!h&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-surface/80 z-10",children:(0,l.jsx)("div",{className:"text-text-muted",children:"Loading embeddings..."})})]}),b.length>0&&(0,l.jsxs)("div",{className:"w-36 border-l border-border bg-surface-light p-2 overflow-y-auto",children:[(0,l.jsx)("div",{className:"text-xs font-medium mb-2 text-text-muted",children:"Labels"}),(0,l.jsxs)("div",{className:"space-y-1",children:[b.slice(0,20).map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:"undefined"===e?"#008080":h?.label_colors[e]||"#888"}}),(0,l.jsx)("span",{className:"text-xs truncate",title:e,children:e})]},e)),b.length>20&&(0,l.jsxs)("div",{className:"text-xs text-text-muted",children:["+",b.length-20," more"]})]})]})]}),(0,l.jsx)("div",{className:"px-3 py-2 text-xs text-text-muted border-t border-border bg-surface-light",children:(0,l.jsx)("span",{className:"opacity-70",children:"Shift+drag to lasso select • Scroll to zoom • Drag to pan"})})]})}function eB(){let{datasetInfo:e,selectedIds:t,clearSelection:n}=S();return(0,l.jsxs)("header",{className:"h-14 bg-surface border-b border-border flex items-center justify-between px-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-lg bg-primary flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-lg font-semibold text-text",children:"HyperView"}),e&&(0,l.jsx)("p",{className:"text-xs text-text-muted",children:e.name})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[e&&(0,l.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-text-muted",children:"Samples:"}),(0,l.jsx)("span",{className:"text-text font-medium",children:e.num_samples.toLocaleString()})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-text-muted",children:"Labels:"}),(0,l.jsx)("span",{className:"text-text font-medium",children:e.labels.length})]})]}),t.size>0&&(0,l.jsxs)("button",{onClick:n,className:"px-3 py-1.5 text-sm bg-surface-light hover:bg-border rounded-md transition-colors",children:["Clear selection (",t.size,")"]})]})]})}async function eK(){let e=await fetch("/api/dataset");if(!e.ok)throw Error(`Failed to fetch dataset: ${e.statusText}`);return e.json()}async function eU(e=0,t=100,n){let r=new URLSearchParams({offset:e.toString(),limit:t.toString()});n&&r.set("label",n);let i=await fetch(`/api/samples?${r}`);if(!i.ok)throw Error(`Failed to fetch samples: ${i.statusText}`);return i.json()}async function eX(){let e=await fetch("/api/embeddings");if(!e.ok)throw Error(`Failed to fetch embeddings: ${e.statusText}`);return e.json()}async function eY(e){let t=await fetch("/api/samples/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sample_ids:e})});if(!t.ok)throw Error(`Failed to fetch samples batch: ${t.statusText}`);return(await t.json()).samples}function eG(){let{samples:e,totalSamples:t,setSamples:n,appendSamples:r,addSamplesIfMissing:i,setDatasetInfo:s,setEmbeddings:o,setIsLoading:c,isLoading:h,error:u,setError:d,selectedIds:f}=S(),[m,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{c(!0),d(null);try{let[e,t,r]=await Promise.all([eK(),eU(0,100),eX()]);s(e),n(t.samples,t.total),o(r)}catch(e){console.error("Failed to load data:",e),d(e instanceof Error?e.message:"Failed to load data")}finally{c(!1)}})()},[]),(0,a.useEffect)(()=>{(async()=>{if(0===f.size)return;let t=new Set(e.map(e=>e.id)),n=Array.from(f).filter(e=>!t.has(e));if(0!==n.length)try{let e=await eY(n);i(e)}catch(e){console.error("Failed to fetch selected samples:",e)}})()},[f,e,i]);let x=(0,a.useCallback)(async()=>{if(!m&&!(e.length>=t)){g(!0);try{let t=await eU(e.length,100);r(t.samples)}catch(e){console.error("Failed to load more samples:",e)}finally{g(!1)}}},[e.length,t,m,r]);return u?(0,l.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,l.jsx)(eB,{}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-red-500 text-lg mb-2",children:"Error"}),(0,l.jsx)("div",{className:"text-text-muted",children:u}),(0,l.jsx)("p",{className:"text-text-muted mt-4 text-sm",children:"Make sure the HyperView backend is running on port 5151."})]})})]}):h?(0,l.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,l.jsx)(eB,{}),(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,l.jsx)("div",{className:"text-text-muted",children:"Loading dataset..."})]})})]}):(0,l.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,l.jsx)(eB,{}),(0,l.jsxs)("div",{className:"flex-1 flex gap-2 p-2 overflow-hidden",children:[(0,l.jsx)("div",{className:"w-1/2 min-w-0",children:(0,l.jsx)(k,{samples:e,onLoadMore:x,hasMore:e.length<t})}),(0,l.jsx)("div",{className:"w-1/2 min-w-0",children:(0,l.jsx)(eV,{})})]})]})}e.s(["default",()=>eG],52683)}]);
