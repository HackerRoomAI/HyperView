(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52683,e=>{"use strict";let t;var s=e.i(43476),i=e.i(71645),l=e.i(74080);function n(e,t,s){let i,l=s.initialDeps??[];function n(){var n,r,a,o;let d,c;s.key&&(null==(n=s.debug)?void 0:n.call(s))&&(d=Date.now());let h=e();if(!(h.length!==l.length||h.some((e,t)=>l[t]!==e)))return i;if(l=h,s.key&&(null==(r=s.debug)?void 0:r.call(s))&&(c=Date.now()),i=t(...h),s.key&&(null==(a=s.debug)?void 0:a.call(s))){let e=Math.round((Date.now()-d)*100)/100,t=Math.round((Date.now()-c)*100)/100,i=t/16,l=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${l(t,5)} /${l(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*i,120))}deg 100% 31%);`,null==s?void 0:s.key)}return null==(o=null==s?void 0:s.onChange)||o.call(s,i),i}return n.updateDeps=e=>{l=e},n}function r(e,t){if(void 0!==e)return e;throw Error(`Unexpected undefined${t?`: ${t}`:""}`)}e.i(47167);let a=e=>{let{offsetWidth:t,offsetHeight:s}=e;return{width:t,height:s}},o=e=>e,d=e=>{let t=Math.max(e.startIndex-e.overscan,0),s=Math.min(e.endIndex+e.overscan,e.count-1),i=[];for(let e=t;e<=s;e++)i.push(e);return i},c=(e,t)=>{let s=e.scrollElement;if(!s)return;let i=e.targetWindow;if(!i)return;let l=e=>{let{width:s,height:i}=e;t({width:Math.round(s),height:Math.round(i)})};if(l(a(s)),!i.ResizeObserver)return()=>{};let n=new i.ResizeObserver(t=>{let i=()=>{let e=t[0];if(null==e?void 0:e.borderBoxSize){let t=e.borderBoxSize[0];if(t)return void l({width:t.inlineSize,height:t.blockSize})}l(a(s))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(i):i()});return n.observe(s,{box:"border-box"}),()=>{n.unobserve(s)}},h={passive:!0},u="undefined"==typeof window||"onscrollend"in window,m=(e,t)=>{var s,i;let l,n=e.scrollElement;if(!n)return;let r=e.targetWindow;if(!r)return;let a=0,o=e.options.useScrollendEvent&&u?()=>void 0:(s=()=>{t(a,!1)},i=e.options.isScrollingResetDelay,function(...e){r.clearTimeout(l),l=r.setTimeout(()=>s.apply(this,e),i)}),d=s=>()=>{let{horizontal:i,isRtl:l}=e.options;a=i?n.scrollLeft*(l&&-1||1):n.scrollTop,o(),t(a,s)},c=d(!0),m=d(!1);m(),n.addEventListener("scroll",c,h);let f=e.options.useScrollendEvent&&u;return f&&n.addEventListener("scrollend",m,h),()=>{n.removeEventListener("scroll",c),f&&n.removeEventListener("scrollend",m)}},f=(e,t,s)=>{if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return Math.round(e[s.options.horizontal?"inlineSize":"blockSize"])}return e[s.options.horizontal?"offsetWidth":"offsetHeight"]},g=(e,{adjustments:t=0,behavior:s},i)=>{var l,n;null==(n=null==(l=i.scrollElement)?void 0:l.scrollTo)||n.call(l,{[i.options.horizontal?"left":"top"]:e+t,behavior:s})};class x{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null,t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{let t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var s;null==(s=t())||s.disconnect(),e=null},observe:e=>{var s;return null==(s=t())?void 0:s.observe(e,{box:"border-box"})},unobserve:e=>{var s;return null==(s=t())?void 0:s.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,s])=>{void 0===s&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:o,rangeExtractor:d,onChange:()=>{},measureElement:f,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,s;null==(s=(t=this.options).onChange)||s.call(t,this,e)},this.maybeNotify=n(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;let t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{let s=new Map,i=new Map;for(let l=t-1;l>=0;l--){let t=e[l];if(s.has(t.lane))continue;let n=i.get(t.lane);if(null==n||t.end>n.end?i.set(t.lane,t):t.end<n.end&&s.set(t.lane,!0),s.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=n(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,t,s,i,l)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:s,getItemKey:i,enabled:l}),{key:!1}),this.getMeasurements=n(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:s,getItemKey:i,enabled:l},n)=>{if(!l)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));let r=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];let a=this.measurementsCache.slice(0,r);for(let l=r;l<e;l++){let e=i(l),r=1===this.options.lanes?a[l-1]:this.getFurthestMeasurement(a,l),o=r?r.end+this.options.gap:t+s,d=n.get(e),c="number"==typeof d?d:this.options.estimateSize(l),h=o+c,u=r?r.lane:l%this.options.lanes;a[l]={index:l,start:o,size:c,end:h,key:e,lane:u}}return this.measurementsCache=a,a},{key:!1,debug:()=>this.options.debug}),this.calculateRange=n(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,s,i)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:s,lanes:i}){let l=e.length-1;if(e.length<=i)return{startIndex:0,endIndex:l};let n=p(0,l,t=>e[t].start,s),r=n;if(1===i)for(;r<l&&e[r].end<s+t;)r++;else if(i>1){let a=Array(i).fill(0);for(;r<l&&a.some(e=>e<s+t);){let t=e[r];a[t.lane]=t.end,r++}let o=Array(i).fill(s+t);for(;n>=0&&o.some(e=>e>=s);){let t=e[n];o[t.lane]=t.start,n--}n=Math.max(0,n-n%i),r=Math.min(l,r+(i-1-r%i))}return{startIndex:n,endIndex:r}}({measurements:e,outerSize:t,scrollOffset:s,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=n(()=>{let e=null,t=null,s=this.calculateRange();return s&&(e=s.startIndex,t=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,s,i,l)=>null===i||null===l?[]:e({startIndex:i,endIndex:l,overscan:t,count:s}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{let t=this.options.indexAttribute,s=e.getAttribute(t);return s?parseInt(s,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{let s=this.indexFromElement(e),i=this.measurementsCache[s];if(!i)return;let l=i.key,n=this.elementsCache.get(l);n!==e&&(n&&this.observer.unobserve(n),this.observer.observe(e),this.elementsCache.set(l,e)),e.isConnected&&this.resizeItem(s,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{let s=this.measurementsCache[e];if(!s)return;let i=t-(this.itemSizeCache.get(s.key)??s.size);0!==i&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(s,i,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=n(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{let s=[];for(let i=0,l=e.length;i<l;i++){let l=t[e[i]];s.push(l)}return s},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{let t=this.getMeasurements();if(0!==t.length)return r(t[p(0,t.length-1,e=>r(t[e]).start,e)])},this.getOffsetForAlignment=(e,t,s=0)=>{let i=this.getSize(),l=this.getScrollOffset();return"auto"===t&&(t=e>=l+i?"end":"start"),"center"===t?e+=(s-i)/2:"end"===t&&(e-=i),Math.max(Math.min(this.getTotalSize()+this.options.scrollMargin-i,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));let s=this.measurementsCache[e];if(!s)return;let i=this.getSize(),l=this.getScrollOffset();if("auto"===t)if(s.end>=l+i-this.options.scrollPaddingEnd)t="end";else{if(!(s.start<=l+this.options.scrollPaddingStart))return[l,t];t="start"}let n="end"===t?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(n,t,s.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:s}={})=>{"smooth"===s&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:s})},this.scrollToIndex=(e,{align:t="auto",behavior:s}={})=>{"smooth"===s&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let i=0,l=t=>{if(!this.targetWindow)return;let i=this.getOffsetForIndex(e,t);if(!i)return void console.warn("Failed to get offset for index:",e);let[l,r]=i;this._scrollToOffset(l,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame(()=>{let t=this.getScrollOffset(),s=this.getOffsetForIndex(e,r);s?1.01>Math.abs(s[0]-t)||n(r):console.warn("Failed to get offset for index:",e)})},n=t=>{this.targetWindow&&(++i<10?this.targetWindow.requestAnimationFrame(()=>l(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};l(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;let t,s=this.getMeasurements();if(0===s.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=s[s.length-1])?void 0:e.end)??0;else{let e=Array(this.options.lanes).fill(null),i=s.length-1;for(;i>=0&&e.some(e=>null===e);){let t=s[i];null===e[t.lane]&&(e[t.lane]=t.end),i--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:s})=>{this.options.scrollToFn(e,{behavior:s,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}let p=(e,t,s,i)=>{for(;e<=t;){let l=(e+t)/2|0,n=s(l);if(n<i)e=l+1;else{if(!(n>i))return l;t=l-1}}return e>0?e-1:0},b="undefined"!=typeof document?i.useLayoutEffect:i.useEffect,v=e=>{let t,s=new Set,i=(e,i)=>{let l="function"==typeof e?e(t):e;if(!Object.is(l,t)){let e=t;t=(null!=i?i:"object"!=typeof l||null===l)?l:Object.assign({},t,l),s.forEach(s=>s(t,e))}},l=()=>t,n={setState:i,getState:l,getInitialState:()=>r,subscribe:e=>(s.add(e),()=>s.delete(e))},r=t=e(i,l,n);return n},y=e=>{let t=e?v(e):v,s=e=>(function(e,t=e=>e){let s=i.default.useSyncExternalStore(e.subscribe,i.default.useCallback(()=>t(e.getState()),[e,t]),i.default.useCallback(()=>t(e.getInitialState()),[e,t]));return i.default.useDebugValue(s),s})(t,e);return Object.assign(s,t),s},w=(t=(e,t)=>({datasetInfo:null,setDatasetInfo:t=>e({datasetInfo:t}),samples:[],totalSamples:0,setSamples:(t,s)=>e({samples:t,totalSamples:s}),appendSamples:t=>e(e=>({samples:[...e.samples,...t]})),embeddings:null,setEmbeddings:t=>e({embeddings:t}),viewMode:"euclidean",setViewMode:t=>e({viewMode:t}),selectedIds:new Set,setSelectedIds:t=>e({selectedIds:t}),toggleSelection:t=>e(e=>{let s=new Set(e.selectedIds);return s.has(t)?s.delete(t):s.add(t),{selectedIds:s}}),addToSelection:t=>e(e=>{let s=new Set(e.selectedIds);return t.forEach(e=>s.add(e)),{selectedIds:s}}),clearSelection:()=>e({selectedIds:new Set}),hoveredId:null,setHoveredId:t=>e({hoveredId:t}),isLoading:!1,setIsLoading:t=>e({isLoading:t}),error:null,setError:t=>e({error:t}),filterLabel:null,setFilterLabel:t=>e({filterLabel:t}),showLabels:!0,setShowLabels:t=>e({showLabels:t})}))?y(t):y;function j({samples:e,onLoadMore:t,hasMore:n}){let r=(0,i.useRef)(null),{selectedIds:a,toggleSelection:o,addToSelection:d,setHoveredId:h,hoveredId:u}=w(),f=function(e){let t=i.useReducer(()=>({}),{})[1],s={...e,onChange:(s,i)=>{var n;i?(0,l.flushSync)(t):t(),null==(n=e.onChange)||n.call(e,s,i)}},[n]=i.useState(()=>new x(s));return n.setOptions(s),b(()=>n._didMount(),[]),b(()=>n._willUpdate()),n}({observeElementRect:c,observeElementOffset:m,scrollToFn:g,...{count:Math.ceil(e.length/4),getScrollElement:()=>r.current,estimateSize:()=>148,overscan:5}});(0,i.useEffect)(()=>{let e=r.current;if(!e||!t||!n)return;let s=()=>{let{scrollTop:s,scrollHeight:i,clientHeight:l}=e;i-s-l<500&&t()};return e.addEventListener("scroll",s),()=>e.removeEventListener("scroll",s)},[t,n]);let p=(0,i.useCallback)((t,s)=>{if(s.metaKey||s.ctrlKey)o(t.id);else if(s.shiftKey&&a.size>0){let s=Array.from(a),i=s[s.length-1],l=e.findIndex(e=>e.id===i),n=e.findIndex(e=>e.id===t.id);if(-1!==l&&-1!==n){let t=Math.min(l,n),s=Math.max(l,n);d(e.slice(t,s+1).map(e=>e.id))}}else{let e=new Set;e.add(t.id),w.getState().setSelectedIds(e)}},[e,a,o,d]),v=f.getVirtualItems();return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-surface rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border bg-surface-light",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Samples"}),(0,s.jsxs)("span",{className:"text-xs text-text-muted",children:[e.length," items",a.size>0&&` (${a.size} selected)`]})]})}),(0,s.jsx)("div",{ref:r,className:"flex-1 overflow-auto p-2",children:(0,s.jsx)("div",{style:{height:`${f.getTotalSize()}px`,width:"100%",position:"relative"},children:v.map(t=>{let i=4*t.index,l=e.slice(i,i+4);return(0,s.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"140px",transform:`translateY(${t.start}px)`},className:"flex gap-2 px-1",children:[l.map(e=>{let t=a.has(e.id),i=u===e.id;return(0,s.jsxs)("div",{className:`
                        relative flex-1 rounded-md overflow-hidden cursor-pointer
                        transition-all duration-150 ease-out
                        ${t?"ring-2 ring-primary":""}
                        ${i?"ring-2 ring-primary-light":""}
                      `,onClick:t=>p(e,t),onMouseEnter:()=>h(e.id),onMouseLeave:()=>h(null),children:[e.thumbnail?(0,s.jsx)("img",{src:`data:image/jpeg;base64,${e.thumbnail}`,alt:e.filename,className:"w-full h-full object-cover",loading:"lazy"}):(0,s.jsx)("div",{className:"w-full h-full bg-surface-light flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-text-muted text-xs",children:"No image"})}),e.label&&(0,s.jsx)("div",{className:"absolute bottom-1 left-1 right-1",children:(0,s.jsx)("span",{className:"inline-block px-1.5 py-0.5 text-xs rounded truncate max-w-full",style:{backgroundColor:"rgba(0,0,0,0.7)",color:"#fff"},children:e.label})}),t&&(0,s.jsx)("div",{className:"absolute top-1 right-1 w-5 h-5 rounded-full bg-primary flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},e.id)}),Array.from({length:4-l.length}).map((e,t)=>(0,s.jsx)("div",{className:"flex-1"},`empty-${t}`))]},t.key)})})})]})}function S({className:t=""}){let l=(0,i.useRef)(null),n=(0,i.useRef)(null),r=(0,i.useRef)(null),[a,o]=(0,i.useState)(!1),{embeddings:d,viewMode:c,setViewMode:h,selectedIds:u,setSelectedIds:m,hoveredId:f,setHoveredId:g}=w();(0,i.useEffect)(()=>{if(l.current&&n.current&&!a)return(async()=>{try{let t=(await e.A(93347)).default,{width:s,height:i}=n.current.getBoundingClientRect(),a=t({canvas:l.current,width:s,height:i,pointSize:4,pointSizeSelected:8,opacity:.8,opacityInactiveMax:.2,lassoColor:[1,.41,.21,1],lassoMinDelay:10,lassoMinDist:2,showReticle:!0,reticleColor:[1,1,1,.5]});a.subscribe("select",({points:e})=>{if(e.length>0){let t=w.getState().embeddings;if(t){let s=new Set(e.map(e=>t.ids[e]));m(s)}}}),a.subscribe("deselect",()=>{m(new Set)}),a.subscribe("pointOver",e=>{let t=w.getState().embeddings;t&&e>=0&&g(t.ids[e])}),a.subscribe("pointOut",()=>{g(null)}),r.current=a,o(!0)}catch(e){console.error("Failed to initialize scatterplot:",e)}})(),()=>{r.current&&(r.current.destroy(),r.current=null,o(!1))}},[]),(0,i.useEffect)(()=>{if(!r.current||!d)return;let e="euclidean"===c?d.euclidean:d.hyperbolic,t=[...new Set(d.labels.filter(Boolean))],s={};t.forEach((e,t)=>{e&&(s[e]=t)});let i=d.labels.map(e=>e&&void 0!==s[e]?s[e]:0),l=t.map(e=>{if(e&&d.label_colors[e]){var t;let s;return[...(t=d.label_colors[e],(s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))?[parseInt(s[1],16)/255,parseInt(s[2],16)/255,parseInt(s[3],16)/255]:[.5,.5,.5]),1]}return[.5,.5,.5,1]});l.length>0&&r.current.set({pointColor:l}),r.current.draw({x:e.map(e=>e[0]),y:e.map(e=>e[1]),category:i})},[d,c,a]),(0,i.useEffect)(()=>{if(!r.current||!d)return;let e=Array.from(u).map(e=>d.ids.indexOf(e)).filter(e=>-1!==e);r.current.select(e,{preventEvent:!0})},[u,d,a]),(0,i.useEffect)(()=>{if(!n.current||!r.current)return;let e=new ResizeObserver(e=>{for(let t of e){let{width:e,height:s}=t.contentRect;e>0&&s>0&&r.current&&r.current.set({width:e,height:s})}});return e.observe(n.current),()=>e.disconnect()},[a]);let x=d?[...new Set(d.labels.filter(Boolean))]:[];return(0,s.jsxs)("div",{className:`flex flex-col h-full bg-surface rounded-lg overflow-hidden ${t}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border bg-surface-light",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Embeddings"}),(0,s.jsxs)("div",{className:"flex rounded-md overflow-hidden border border-border",children:[(0,s.jsx)("button",{onClick:()=>h("euclidean"),className:`px-3 py-1 text-xs transition-colors ${"euclidean"===c?"bg-primary text-white":"bg-surface hover:bg-surface-light text-text-muted"}`,children:"Euclidean"}),(0,s.jsx)("button",{onClick:()=>h("hyperbolic"),className:`px-3 py-1 text-xs transition-colors ${"hyperbolic"===c?"bg-primary text-white":"bg-surface hover:bg-surface-light text-text-muted"}`,children:"Hyperbolic"})]})]}),(0,s.jsx)("span",{className:"text-xs text-text-muted",children:d?`${d.ids.length} points`:"Loading..."})]}),(0,s.jsxs)("div",{className:"flex-1 flex",children:[(0,s.jsxs)("div",{ref:n,className:"flex-1 relative",children:["hyperbolic"===c&&(0,s.jsx)("svg",{className:"absolute inset-0 pointer-events-none",width:"100%",height:"100%",style:{zIndex:0},children:(0,s.jsx)("circle",{cx:"50%",cy:"50%",r:"45%",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"2",strokeDasharray:"4,4"})}),(0,s.jsx)("canvas",{ref:l,className:"absolute inset-0",style:{zIndex:1}}),!d&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-surface/80 z-10",children:(0,s.jsx)("div",{className:"text-text-muted",children:"Loading embeddings..."})})]}),x.length>0&&(0,s.jsxs)("div",{className:"w-36 border-l border-border bg-surface-light p-2 overflow-y-auto",children:[(0,s.jsx)("div",{className:"text-xs font-medium mb-2 text-text-muted",children:"Labels"}),(0,s.jsxs)("div",{className:"space-y-1",children:[x.slice(0,20).map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:d?.label_colors[e]||"#888"}}),(0,s.jsx)("span",{className:"text-xs truncate",title:e,children:e})]},e)),x.length>20&&(0,s.jsxs)("div",{className:"text-xs text-text-muted",children:["+",x.length-20," more"]})]})]})]}),(0,s.jsx)("div",{className:"px-3 py-2 text-xs text-text-muted border-t border-border bg-surface-light",children:(0,s.jsx)("span",{className:"opacity-70",children:"Shift+drag to lasso select • Scroll to zoom • Drag to pan"})})]})}function N(){let{datasetInfo:e,selectedIds:t,clearSelection:i}=w();return(0,s.jsxs)("header",{className:"h-14 bg-surface border-b border-border flex items-center justify-between px-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-lg bg-primary flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-lg font-semibold text-text",children:"HyperView"}),e&&(0,s.jsx)("p",{className:"text-xs text-text-muted",children:e.name})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[e&&(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-text-muted",children:"Samples:"}),(0,s.jsx)("span",{className:"text-text font-medium",children:e.num_samples.toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-text-muted",children:"Labels:"}),(0,s.jsx)("span",{className:"text-text font-medium",children:e.labels.length})]})]}),t.size>0&&(0,s.jsxs)("button",{onClick:i,className:"px-3 py-1.5 text-sm bg-surface-light hover:bg-border rounded-md transition-colors",children:["Clear selection (",t.size,")"]})]})]})}async function M(){let e=await fetch("/api/dataset");if(!e.ok)throw Error(`Failed to fetch dataset: ${e.statusText}`);return e.json()}async function E(e=0,t=100,s){let i=new URLSearchParams({offset:e.toString(),limit:t.toString()});s&&i.set("label",s);let l=await fetch(`/api/samples?${i}`);if(!l.ok)throw Error(`Failed to fetch samples: ${l.statusText}`);return l.json()}async function z(){let e=await fetch("/api/embeddings");if(!e.ok)throw Error(`Failed to fetch embeddings: ${e.statusText}`);return e.json()}function C(){let{samples:e,totalSamples:t,setSamples:l,appendSamples:n,setDatasetInfo:r,setEmbeddings:a,setIsLoading:o,isLoading:d,error:c,setError:h}=w(),[u,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{o(!0),h(null);try{let[e,t,s]=await Promise.all([M(),E(0,100),z()]);r(e),l(t.samples,t.total),a(s)}catch(e){console.error("Failed to load data:",e),h(e instanceof Error?e.message:"Failed to load data")}finally{o(!1)}})()},[]);let f=(0,i.useCallback)(async()=>{if(!u&&!(e.length>=t)){m(!0);try{let t=await E(e.length,100);n(t.samples)}catch(e){console.error("Failed to load more samples:",e)}finally{m(!1)}}},[e.length,t,u,n]);return c?(0,s.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,s.jsx)(N,{}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-red-500 text-lg mb-2",children:"Error"}),(0,s.jsx)("div",{className:"text-text-muted",children:c}),(0,s.jsx)("p",{className:"text-text-muted mt-4 text-sm",children:"Make sure the HyperView backend is running on port 5151."})]})})]}):d?(0,s.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,s.jsx)(N,{}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("div",{className:"text-text-muted",children:"Loading dataset..."})]})})]}):(0,s.jsxs)("div",{className:"h-screen flex flex-col bg-background",children:[(0,s.jsx)(N,{}),(0,s.jsxs)("div",{className:"flex-1 flex gap-2 p-2 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-1/2 min-w-0",children:(0,s.jsx)(j,{samples:e,onLoadMore:f,hasMore:e.length<t})}),(0,s.jsx)("div",{className:"w-1/2 min-w-0",children:(0,s.jsx)(S,{})})]})]})}e.s(["default",()=>C],52683)},93347,e=>{e.v(t=>Promise.all(["static/chunks/6dd1fc7c515721e7.js"].map(t=>e.l(t))).then(()=>t(42030)))}]);